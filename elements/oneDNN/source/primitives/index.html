

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Primitives &mdash; oneAPI Specification 0.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Common definitions" href="general.html" />
    <link rel="prev" title="Memory Descriptors and Objects" href="../data_model/memory/objects.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++ 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL 0.7</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">oneDNN 0.7</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../execution_model/index.html">Execution Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_model/index.html">Data model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Primitives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="general.html">Common definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="attributes/index.html">Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="convolution.html">Convolution and Deconvolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="inner-product.html">Inner Product</a></li>
<li class="toctree-l3"><a class="reference internal" href="rnn.html">RNN</a></li>
<li class="toctree-l3"><a class="reference internal" href="normalization.html">Normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="concat.html">Concat</a></li>
<li class="toctree-l3"><a class="reference internal" href="binary.html">Binary</a></li>
<li class="toctree-l3"><a class="reference internal" href="eltwise.html">Element-wise</a></li>
<li class="toctree-l3"><a class="reference internal" href="layer_normalization.html">Layer normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="lrn.html">Local Response Normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="logsoftmax.html">LogSoftmax</a></li>
<li class="toctree-l3"><a class="reference internal" href="pooling.html">Pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="resampling.html">Resampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="softmax.html">Softmax</a></li>
<li class="toctree-l3"><a class="reference internal" href="shuffle.html">Shuffle</a></li>
<li class="toctree-l3"><a class="reference internal" href="sum.html">Sum</a></li>
<li class="toctree-l3"><a class="reference internal" href="reorder.html">Reorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="matmul.html">Matrix Multiplication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id1">Open Source Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#implementation-notes">Implementation Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero 0.91</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneTBB/source/nested-index.html">oneTBB 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneVPL/source/index.html">oneVPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../index.html">oneDNN 0.7</a> </li>
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneDNN/source/primitives/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="primitives">
<h1>Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">¶</a></h1>
<p><em>Primitives</em> are functor objects that encapsulates a particular computation
such as forward convolution, backward LSTM computations, or a data
transformation operation. A single primitive can sometimes represent more
complex fused computations such as a forward convolution followed by a ReLU.</p>
<p>The most important difference between a primitive and a pure function is
that a primitive can store state.</p>
<p>One part of the primitive’s state is immutable. For example, convolution
primitives store parameters like tensor shapes and can pre-compute other
dependent parameters like cache blocking. This approach allows oneDNN
primitives to pre-generate code specifically tailored for the operation to be
performed. The oneDNN programming model assumes that the time it takes to
perform the pre-computations is amortized by reusing the same primitive to
perform computations multiple times.</p>
<p>The mutable part of the primitive’s state is referred to as a scratchpad. It
is a memory buffer that a primitive may use for temporary storage only during
computations. The scratchpad can either be owned by a primitive object (which
makes that object non-thread safe) or be an execution-time parameter.</p>
<p>Each primitive is defined using several abstraction levels.</p>
<a class="reference internal image-reference" href="../../../../_images/img_primitive.png"><img alt="oneDNN primitive dependencies diagram" src="../../../../_images/img_primitive.png" style="width: 600px;" /></a>
<ul class="simple">
<li><p>Operation descriptors (one for each supported primitive) describe an
operation’s most basic properties without specifying, for example, which
engine will be used to compute them. For example, convolution descriptor
describes shapes of source, destination, and weights tensors, propagation
kind (forward, backward with respect to data or weights), and other
implementation-independent parameters. The shapes are usually described as
memory descriptors (<a class="reference internal" href="../data_model/memory/objects.html#_CPPv4N4dnnl6memory4descE" title="dnnl::memory::desc"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">dnnl::memory::desc</span></code></a>).</p></li>
<li><p>Primitive descriptors (<a class="reference internal" href="general.html#_CPPv4N4dnnl19primitive_desc_baseE" title="dnnl::primitive_desc_base"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">dnnl::primitive_desc_base</span></code></a> is the base class
and each of the supported primitives have their own version) are at an
abstraction level in between operation descriptors and primitives and can be
used to inspect details of a specific primitive implementation like expected
memory formats via queries to implement memory format propagation (see
Memory format propagation) without having to fully instantiate a primitive.</p></li>
</ul>
<p>Hence, the sequence of actions to create a primitive is:</p>
<ol class="arabic simple">
<li><p>Create an operation descriptor via, for example,
<a class="reference internal" href="convolution.html#_CPPv4N4dnnl19convolution_forward4descE" title="dnnl::convolution_forward::desc"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::convolution_forward::desc</span></code></a>. The operation descriptor can
contain memory descriptors with placeholder
<a class="reference internal" href="../data_model/memory/formats.html#_CPPv4N4dnnl6memory10format_tag3anyE" title="dnnl::memory::format_tag::any"><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">dnnl::memory::format_tag::any</span></code></a> memory formats if the primitive
supports it.</p></li>
<li><p>Create a primitive descriptor based on the operation descriptor, engine and
attributes.</p></li>
<li><p>Create a primitive based on the primitive descriptor obtained in step 2.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Strictly speaking, not all the primitives follow this sequence. For
example, the reorder primitive does not have an operation descriptor and
thus does not require step 1 above.</p>
</div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="general.html">Common definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="attributes/index.html">Attributes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="attributes/scratchpad.html">Scratchpad Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="attributes/quantization.html">Quantization</a></li>
<li class="toctree-l2"><a class="reference internal" href="attributes/post-ops.html">Post-ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="attributes/index.html#attribute-related-error-handling">Attribute Related Error Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="convolution.html">Convolution and Deconvolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="inner-product.html">Inner Product</a></li>
<li class="toctree-l1"><a class="reference internal" href="rnn.html">RNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="normalization.html">Normalization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="batch_normalization.html">Batch normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="layer_normalization.html">Layer normalization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concat.html">Concat</a></li>
<li class="toctree-l1"><a class="reference internal" href="binary.html">Binary</a></li>
<li class="toctree-l1"><a class="reference internal" href="eltwise.html">Element-wise</a></li>
<li class="toctree-l1"><a class="reference internal" href="layer_normalization.html">Layer normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="lrn.html">Local Response Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="logsoftmax.html">LogSoftmax</a></li>
<li class="toctree-l1"><a class="reference internal" href="pooling.html">Pooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="resampling.html">Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="softmax.html">Softmax</a></li>
<li class="toctree-l1"><a class="reference internal" href="shuffle.html">Shuffle</a></li>
<li class="toctree-l1"><a class="reference internal" href="sum.html">Sum</a></li>
<li class="toctree-l1"><a class="reference internal" href="reorder.html">Reorder</a></li>
<li class="toctree-l1"><a class="reference internal" href="matmul.html">Matrix Multiplication</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="general.html" class="btn btn-neutral float-right" title="Common definitions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../data_model/memory/objects.html" class="btn btn-neutral float-left" title="Memory Descriptors and Objects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>